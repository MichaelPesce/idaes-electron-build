name: Test Electron Build

on:
  push:
    branches: [build]

jobs:
  test-electron-build:
    strategy:
        fail-fast: false
        matrix:
            project: [watertap, prommis, idaes]
            os: [arm64, win64]
            include: 
                - project: watertap
                  pip-install-target: watertap@git+https://github.com/watertap-org/watertap@1.2.0rc0
                  artifact-name: WaterTAP-Flowsheet-Processor
                - project: prommis
                  pip-install-target: prommis@git+https://github.com/MichaelPesce/prommis@update-entrypoint
                  artifact-name: PROMMIS-Flowsheet-Processor
                - project: idaes
                  pip-install-target: idaes-pse@git+https://github.com/dangunter/idaes-pse@west_coast_wrapper
                  artifact-name: IDAES-Flowsheet-Processor
                - os: arm64
                  os-version: macos-latest
                  artifact-file-extension: dmg
                - os: win64
                  os-version: windows-latest
                  artifact-file-extension: exe

    name: ${{ matrix.project }} Electron build 
    uses: ./.github/workflows/electron-build.yml
    with:
        project: ${{ matrix.project }}
        pip-install-target: ${{ matrix.pip-install-target }}
        artifact-name: ${{ matrix.artifact-name }}
        idaes-flowsheet-processor-ui-repo: MichaelPesce/idaes-flowsheet-processor-ui
        idaes-flowsheet-processor-ui-ref: initial-cleanup
        os: ${{ matrix.os }}
        os-version: ${{ matrix.os-version }}
        artifact-file-extension: ${{ matrix.artifact-file-extension }}
    secrets: inherit